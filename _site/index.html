<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Anton Davydov &middot; Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/base.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- SEO -->
  

  <link rel="author" href="https://plus.google.com/u/0/104253015484296728880"/>
</head>


  <body>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Simple blog where I'll write about ruby, my ideas and technologies which I love<br><a href="https://twitter.com/anton_davydov" target="_blank">@anton_davydov</a></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/tags/">All tags</a>
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/davydovanton">GitHub</a>
    <a class="sidebar-nav-item" href="https://twitter.com/anton_davydov">Twitter</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017. All rights reserved.
    </p>
  </div>
</div>

    <div class="yandex_metrica">
<!-- Yandex.Metrika counter --><script type="text/javascript">var yaParams = {/*–ó–¥–µ—Å—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–∑–∏—Ç–∞*/};</script><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter23652886 = new Ya.Metrika({id:23652886, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true,params:window.yaParams||{ }}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/23652886" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Anton Davydov</a>
            <small>Blog</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2017/01/28/profiling-your-sql-querys-in-hanami-or-rom/">
        Profiling your SQL querys in hanami (or ROM)
      </a>
    </h1>

    <span class="post-date">28 Jan 2017</span>

    <p>It just happened I had profile SQL query in <a href="http://www.ossboard.org">my hanami application</a>. And I want to save this knowledge that‚Äôs why I created this post.</p>

<p>If you are using <a href="http://rom-rb.org">ROM</a>, this post will be helpful for you too, because hanami-module uses ROM. So, in <a href="http://hanamirb.org">hanami</a>, you have a simple ability for profiling your SQL queries.</p>

<p>For that, you need to use some methods for <a href="http://www.rubydoc.info/github/evanfarrar/opensprints/Sequel/Dataset"><code class="highlighter-rouge">Sequel::Dataset</code></a> instance.</p>

<p>Fox example, if you want to get pure sql sting you can use <code class="highlighter-rouge">#sql</code> method:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&gt;&gt; puts UserRepository.new.users.where(admin: true).dataset.sql
SELECT * FROM "users" WHERE ("admin" IS TRUE) ORDER BY "users"."id"
=&gt; nil</code></pre></figure>

<p>or if you need to call <code class="highlighter-rouge">ANALYZE</code> or <code class="highlighter-rouge">EXPLAIN</code> psql methods you can use similar methods:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&gt;&gt; puts UserRepository.new.users.where(admin: true).dataset.analyze
Sort  (cost=19.38..19.79 rows=165 width=213) (actual time=0.019..0.019 rows=1 loops=1)
  Sort Key: id
  Sort Method: quicksort  Memory: 25kB
  -&gt;  Seq Scan on users  (cost=0.00..13.30 rows=165 width=213) (actual time=0.013..0.014 rows=1 loops=1)
        Filter: (admin IS TRUE)
        Rows Removed by Filter: 1
Planning time: 4.362 ms
Execution time: 0.039 ms
=&gt; nil</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">&gt;&gt; puts UserRepository.new.users.where(admin: true).dataset.explain
Sort  (cost=19.38..19.79 rows=165 width=213)
  Sort Key: id
  -&gt;  Seq Scan on users  (cost=0.00..13.30 rows=165 width=213)
        Filter: (admin IS TRUE)
=&gt; nil</code></pre></figure>

<p>That‚Äôs all, happy profiling! üöÄ</p>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#hanami"><span>hanami</span></a>
        </li>
      
        <li>
          <a href="/tags/#sql"><span>sql</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/11/23/ruby-tips-part-two/">
        Ruby tips #2
      </a>
    </h1>

    <span class="post-date">23 Nov 2016</span>

    <p>It‚Äôs a second part of my post series about ruby tips. Today you‚Äôll learn more about:</p>

<ul>
  <li>Special values</li>
  <li>Symbol</li>
  <li>Array</li>
  <li>Hash</li>
  <li>Range</li>
</ul>

<p><strong>CAUTION:</strong> These tips are not equally feat to production. Lots of them are just interesting solutions which you‚Äôll not find anywhere else. Use them at your own risk.</p>

<h2 id="special-values">Special values</h2>

<h3 id="safe-levels">Safe Levels</h3>

<p><a href="https://ruby-hacking-guide.github.io/security.html">Full description</a></p>

<p>In ruby you can find security levels for your code.
The Ruby security level is represented by the <code class="highlighter-rouge">$SAFE</code> global variable.
The value ranges from minimum value 0 to maximum value 4.</p>

<table>
  <thead>
    <tr>
      <th>$SAFE</th>
      <th>Constraints</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>No checking of the use of externally supplied (tainted) data is performed. This is Ruby‚Äôs default mode.</td>
    </tr>
    <tr>
      <td>&gt;= 1</td>
      <td>Ruby disallows the use of tainted data by potentially dangerous operations.</td>
    </tr>
    <tr>
      <td>&gt;= 2</td>
      <td>Ruby prohibits the loading of program files from globally writable locations.</td>
    </tr>
    <tr>
      <td>&gt;= 3</td>
      <td>All newly created objects are considered tainted.</td>
    </tr>
    <tr>
      <td>&gt;= 4</td>
      <td>Ruby effectively partitions the running program in two. Nontainted objects may not be modified. Typically, this will be used to create a sandbox: the program sets up an environment using a lower$SAFE level, then resets $SAFE to 4 to prevent subsequent changes to that environment.</td>
    </tr>
  </tbody>
</table>

<h3 id="email-regexp">Email Regexp</h3>

<p>In ruby you can find regexp for emails. If you want to use it, you have to require <code class="highlighter-rouge">uri</code>
library and call <code class="highlighter-rouge">URI::MailTo::EMAIL_REGEXP</code> constant.</p>

<h3 id="data-object">DATA object</h3>

<p>The global <code class="highlighter-rouge">DATA</code> variable in ruby allows us to access the text at the end of our file
listed after the <code class="highlighter-rouge">__END__</code> block. This can be surprisingly useful, for instance if we
need to extract information from a rather large data blob.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># in one file</span>
<span class="nb">require</span> <span class="s2">"json"</span>

<span class="nb">puts</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="no">DATA</span><span class="p">)</span> <span class="c1"># this DATA required text bellow __END__</span>

<span class="cp">__END__
{
  "records": [
    {
      "artist":"Iggy Pop",
      "title":"Lust for Life"
    },
    {
      "artist":"Television",
      "title":"Marquee Moon"
    },
    {
      "artist":"Talking Heads",
      "title":"Talking Heads: 77"
    }
  ]
}</span></code></pre></figure>

<h2 id="symbol">Symbol</h2>

<h3 id="all_symbols">#all_symbols</h3>

<p><a href="https://ruby-doc.org/core-2.2.0/Symbol.html#method-c-all_symbols">Documentation</a></p>

<p>Return array with all symbols in env.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Symbol</span><span class="p">.</span><span class="nf">all_symbols</span><span class="p">.</span><span class="nf">size</span> <span class="c1"># =&gt; 5675</span></code></pre></figure>

<h3 id="id2name">id2name</h3>

<p><a href="https://ruby-doc.org/core-2.2.0/Symbol.html#method-i-id2name">Documentation</a></p>

<p>Alias for <code class="highlighter-rouge">#to_s</code> (I don‚Äôt know why you need to use this but it‚Äôs a funny method I think).</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">:test</span><span class="p">.</span><span class="nf">id2name</span>   <span class="c1">#=&gt; "test"</span></code></pre></figure>

<h3 id="slice">slice</h3>

<p><a href="https://ruby-doc.org/core-2.2.0/Symbol.html#method-i-slice">Documentation</a></p>

<p>Alias for <code class="highlighter-rouge">sym.to_s[]</code>.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">:hello_world</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#=&gt; "hello"</span>
<span class="ss">:hello_world</span><span class="p">.</span><span class="nf">[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="mi">4</span><span class="p">]</span>      <span class="c1">#=&gt; "hello"</span></code></pre></figure>

<h2 id="array">Array</h2>

<h3 id="bsearch">#bsearch</h3>

<p><a href="http://www.ruby-doc.org/core-2.1.5/Array.html#method-i-bsearch">Documentation</a></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">ary</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="n">ary</span><span class="p">.</span><span class="nf">bsearch</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">&gt;=</span>   <span class="mi">4</span> <span class="p">}</span> <span class="c1">#=&gt; 4</span>
<span class="n">ary</span><span class="p">.</span><span class="nf">bsearch</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">&gt;=</span>   <span class="mi">6</span> <span class="p">}</span> <span class="c1">#=&gt; 7</span>
<span class="n">ary</span><span class="p">.</span><span class="nf">bsearch</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">&gt;=</span>  <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="c1">#=&gt; 0</span>
<span class="n">ary</span><span class="p">.</span><span class="nf">bsearch</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="p">}</span> <span class="c1">#=&gt; nil</span></code></pre></figure>

<h3 id="range-to-array">Range to array</h3>

<p>You can use <code class="highlighter-rouge">*</code> operator for converting range to array.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="mi">10</span><span class="p">)</span>

<span class="n">range</span><span class="p">.</span><span class="nf">to_a</span> <span class="o">==</span> <span class="p">[</span><span class="o">*</span><span class="n">range</span><span class="p">]</span> <span class="c1"># =&gt; true</span></code></pre></figure>

<h2 id="hash">Hash</h2>

<h3 id="-method"><code class="highlighter-rouge">**</code> method</h3>

<p>You probably know already how to use <code class="highlighter-rouge">*</code> in method definition argument list. But <code class="highlighter-rouge">**</code> is less known.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">method_name</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="kp">attr</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
  <span class="nb">p</span> <span class="kp">attr</span>
  <span class="nb">p</span> <span class="n">options</span>
<span class="k">end</span>

<span class="n">method_name</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="s1">'cruel'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">,</span> <span class="ss">collor: :red</span><span class="p">)</span>
<span class="c1"># =&gt; ['cruel', 'world']</span>
<span class="c1"># =&gt; { collor: :red }</span></code></pre></figure>

<p>Also you can call this method like <code class="highlighter-rouge">[*attr]</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: :b</span><span class="p">,</span> <span class="ss">c: :d</span> <span class="p">}</span>

<span class="p">{</span> <span class="o">**</span><span class="nb">hash</span><span class="p">,</span> <span class="ss">e: :f</span> <span class="p">}</span> <span class="c1"># =&gt; {:a=&gt;:b, :c=&gt;:d, :e=&gt;:f}</span></code></pre></figure>

<h3 id="gsub-with-hash-args">#gsub with hash args</h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">str</span> <span class="o">=</span> <span class="s2">"Help! All parentheses have been flipped )and I am sad(!"</span>
<span class="n">str</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/[\(\)]/</span><span class="p">,</span> <span class="p">{</span><span class="s2">"("</span><span class="o">=&gt;</span><span class="s2">")"</span><span class="p">,</span> <span class="s2">")"</span><span class="o">=&gt;</span><span class="s2">"("</span><span class="p">})</span>
<span class="c1"># =&gt; "Help! All parentheses have been flipped (and I am sad)!"</span></code></pre></figure>

<h3 id="non-string-and-symbol-keys">Non string and symbol keys</h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="kp">false</span> <span class="o">=&gt;</span> <span class="s1">'No'</span><span class="p">,</span> <span class="ss">:to_s</span><span class="p">.</span><span class="nf">to_proc</span> <span class="o">=&gt;</span> <span class="s1">'proc'</span> <span class="p">}</span>

<span class="nb">hash</span><span class="p">[</span><span class="mi">10</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">]</span>        <span class="c1"># =&gt; "No"</span>
<span class="nb">hash</span><span class="p">[</span><span class="ss">:to_s</span><span class="p">.</span><span class="nf">to_proc</span><span class="p">]</span> <span class="c1"># =&gt; "proc"</span></code></pre></figure>

<h3 id="hashassoc">Hash#assoc</h3>

<p>This method returns a two element array <code class="highlighter-rouge">[key, hash[key]]</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">assoc</span><span class="p">(</span><span class="ss">:b</span><span class="p">)</span> <span class="c1"># =&gt; [:b, 2]</span></code></pre></figure>

<h2 id="range">Range</h2>

<h3 id="cover-and-time">#cover? and time</h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">((</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span><span class="p">).</span><span class="nf">.</span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span><span class="p">)).</span><span class="nf">cover?</span> <span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">((</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span><span class="p">).</span><span class="nf">.</span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span><span class="p">)).</span><span class="nf">cover?</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>           <span class="c1"># =&gt; true</span></code></pre></figure>

<h3 id="ranges-in-case-statements">Ranges in case statements</h3>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">age</span> <span class="o">=</span> <span class="mi">28</span>

<span class="k">case</span> <span class="n">age</span>
<span class="k">when</span> <span class="mo">01</span><span class="p">.</span><span class="nf">.</span><span class="mi">17</span> <span class="k">then</span> <span class="s2">"Young"</span>
<span class="k">when</span> <span class="mi">18</span><span class="p">.</span><span class="nf">.</span><span class="mi">50</span> <span class="k">then</span> <span class="s2">"Adult"</span>
<span class="k">when</span> <span class="mi">50</span><span class="p">.</span><span class="nf">.</span><span class="mi">99</span> <span class="k">then</span> <span class="s2">"Old"</span>
<span class="k">end</span></code></pre></figure>

<h1 id="conclusions">Conclusions</h1>

<p>That‚Äôs all. I hope it‚Äôll be useful for you. In next part we‚Äôre gonna talking about:</p>

<ul>
  <li>Tracing Ruby Code</li>
  <li>memory usage</li>
  <li>Enumerable</li>
  <li>Compiler</li>
  <li>Rspec</li>
  <li>Rails</li>
</ul>

<p>Happy hacking! üöÄ</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/11/16/ruby-tips-part-one/">
        Ruby tips #1
      </a>
    </h1>

    <span class="post-date">16 Nov 2016</span>

    <p>I‚Äôve been collecting the ruby tips for a long time. And now I‚Äôm ready to share them all. Hope you‚Äôll find some interesting solutions, tips and sugars for ruby.</p>

<p>And today we‚Äôre talking about:</p>

<ul>
  <li>Kernel</li>
  <li>Class</li>
  <li>Object</li>
  <li>Proc (lambda)</li>
  <li>Method</li>
</ul>

<p><strong>CAUTION:</strong> These tips are not equally feat to production. Lots of them are just interesting solutions which you‚Äôll not find anywhere else. Use them at your own risk.</p>

<h1 id="kernel">Kernel</h1>

<h2 id="char">Char</h2>

<p>If you want to get string with only one char you can use <code class="highlighter-rouge">?*</code> syntax.
Also you can use this hack in various methods like ‚Äòjoin‚Äô</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sc">?a</span> <span class="o">==</span> <span class="s1">'a'</span> <span class="c1"># =&gt; true</span>

<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="sc">?:</span><span class="p">)</span> <span class="c1"># =&gt; "1:2:3"</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="sc">?:</span> <span class="c1"># =&gt; "1:2:3"</span></code></pre></figure>

<h2 id="callcc">callcc</h2>

<p>You can find <code class="highlighter-rouge">callcc</code> method in any language.
<a href="http://blog.ontoillogical.com/blog/2014/07/12/delimited-continuations-in-ruby/">Ruby is no exception.</a></p>

<h2 id="caller">caller</h2>

<p><a href="https://ruby-doc.org/core-2.3.1/Kernel.html#method-i-caller">Documentation</a></p>

<p>If you want to return the current execution stack you could use <code class="highlighter-rouge">Kernel#caller</code> method.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
  <span class="nb">caller</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
  <span class="n">a</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
  <span class="n">b</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1">#=&gt; ["prog:2:in `a'", "prog:5:in `b'", "prog:8:in `c'", "prog:10:in `&lt;main&gt;'"]</span>
<span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1">#=&gt; ["prog:5:in `b'", "prog:8:in `c'", "prog:11:in `&lt;main&gt;'"]</span>
<span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="c1">#=&gt; ["prog:8:in `c'", "prog:12:in `&lt;main&gt;'"]</span>
<span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="c1">#=&gt; ["prog:13:in `&lt;main&gt;'"]</span>
<span class="n">c</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="c1">#=&gt; []</span>
<span class="n">c</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>   <span class="c1">#=&gt; nil</span></code></pre></figure>

<h2 id="itself">itself</h2>

<p>Ruby went out and got itself an identity method.
For those not familiar, an identity method returns the object it‚Äôs called on:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">itself</span> <span class="c1"># =&gt; 1</span></code></pre></figure>

<h2 id="j-and-jj"><code class="highlighter-rouge">j</code> and <code class="highlighter-rouge">jj</code></h2>

<p>When you require <code class="highlighter-rouge">json</code> library you get two interesting methods.
First is <code class="highlighter-rouge">Kernel#j</code>.
This method outputs object to <code class="highlighter-rouge">STDOUT</code> as JSON strings in the shortest form, that is in one line.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'json'</span>

<span class="n">h</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">}</span>
<span class="n">j</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></code></pre></figure>

<p>And second is <code class="highlighter-rouge">Kernel#jj</code>
This method outputs object to <code class="highlighter-rouge">STDOUT</code> as JSON strings in a pretty format, with indentation, and over many lines.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'json'</span>

<span class="n">h</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span> <span class="p">}</span>
<span class="n">jj</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></code></pre></figure>

<h1 id="class">Class</h1>

<h2 id="allocate">allocate</h2>

<p><a href="https://ruby-doc.org/core-1.9.3/Class.html#method-i-allocate">Documentation</a></p>

<p>Allocates space for a new object of class‚Äôs class and does not call initialize on the new instance.
The returned object must be an instance of a class.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Test</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@var</span> <span class="o">=</span> <span class="s2">"new"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Test</span><span class="p">.</span><span class="nf">new</span>      <span class="c1"># =&gt; #&lt;Test:0x007ff2a34965b8 @var="new"&gt;</span>
<span class="no">Test</span><span class="p">.</span><span class="nf">allocate</span> <span class="c1"># =&gt; #&lt;Test:0x007ff2a34965b8&gt;</span></code></pre></figure>

<h2 id="refinements">Refinements</h2>

<p><a href="http://ruby-doc.org/core-2.1.1/doc/syntax/refinements_rdoc.html">Documentation</a></p>

<p><a href="http://timelessrepo.com/refinements-in-ruby">Usful blog post about refinements</a></p>

<p>Refinements are designed to reduce the impact of monkey patching on other users of the monkey-patched class.
Refinements provide a way to extend a class locally.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">TimeExtensions</span>
  <span class="n">refine</span> <span class="no">Fixnum</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">minutes</span><span class="p">;</span> <span class="nb">self</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">MyApp</span>
  <span class="n">using</span> <span class="no">TimeExtensions</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="nb">p</span> <span class="mi">2</span><span class="p">.</span><span class="nf">minutes</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">MyApp</span><span class="p">.</span><span class="nf">new</span>    <span class="c1"># =&gt; 120</span>
<span class="nb">p</span> <span class="mi">2</span><span class="p">.</span><span class="nf">minutes</span>  <span class="c1"># =&gt; NoMethodError</span></code></pre></figure>

<h1 id="object">Object</h1>

<h2 id="tap">tap</h2>

<p><a href="http://www.ruby-doc.org/core-2.1.5/Object.html#method-i-tap">Documentation</a></p>

<p>Yields x to the block, and than returns x.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="mi">10</span><span class="p">)</span>              <span class="p">.</span><span class="nf">tap</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"original: </span><span class="si">#{</span><span class="n">x</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="p">.</span><span class="nf">to_a</span>              <span class="p">.</span><span class="nf">tap</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"array:    </span><span class="si">#{</span><span class="n">x</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="p">.</span><span class="nf">select</span><span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">}.</span><span class="nf">tap</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"evens:    </span><span class="si">#{</span><span class="n">x</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="p">.</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="p">}</span>  <span class="p">.</span><span class="nf">tap</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"squares:  </span><span class="si">#{</span><span class="n">x</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span></code></pre></figure>

<h1 id="proc-lambda">Proc (lambda)</h1>

<h2 id="curry">curry</h2>

<p><a href="https://ruby-doc.org/core-2.1.1/Proc.html#method-i-curry">Documentation</a></p>

<p>Ruby defines <code class="highlighter-rouge">curry</code> for <code class="highlighter-rouge">Method</code> and <code class="highlighter-rouge">Proc</code>, allowing procs to return partially applied procs when they get called with fewer than the required number of arguments.</p>

<p>For example:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">multiply</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">{</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="p">}.</span><span class="nf">curry</span>
<span class="c1">#=&gt; #&lt;Proc:0x007fed33851510 (lambda)&gt;</span>
<span class="n">multiply</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="c1">#=&gt; 6</span>
<span class="n">double</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1">#=&gt; #&lt;Proc:0x007fed35892888 (lambda)&gt;</span>
<span class="n">double</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="c1">#=&gt; 6</span></code></pre></figure>

<p><em><strong>Note:</strong> While <code class="highlighter-rouge">Proc#curry</code> has been around since Ruby 1.9, <code class="highlighter-rouge">Method#curry</code> was only added in Ruby 2.2.0. For versions before 2.2.0, you will first need to convert your method object to a proc via <code class="highlighter-rouge">Method#to_proc</code>.</em></p>

<h2 id="to_proc-and-method">#to_proc and #method</h2>

<p><a href="https://ruby-doc.org/core-2.1.1/Proc.html#method-i-to_proc">Documentation</a></p>

<p>If you need call method with args in <code class="highlighter-rouge">to_proc</code> you can use <code class="highlighter-rouge">method</code> method:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">[</span><span class="ss">:asd</span><span class="p">,</span> <span class="ss">:bsd</span><span class="p">].</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">i</span> <span class="p">}</span>
<span class="c1"># it's like as</span>
<span class="p">[</span><span class="ss">:asd</span><span class="p">,</span> <span class="ss">:bsd</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:puts</span><span class="p">))</span></code></pre></figure>

<h2 id="all-ways-to-call-proc-lambda">All ways to call proc (lambda)</h2>

<p>You can use 7 different ways to call lambda:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">p</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="s2">"hello"</span> <span class="p">}</span>

<span class="nb">p</span><span class="p">.</span><span class="nf">call</span><span class="p">()</span>
<span class="nb">p</span><span class="o">::</span><span class="p">()</span>
<span class="nb">p</span><span class="o">.</span><span class="p">()</span>
<span class="nb">p</span><span class="p">[]</span>
<span class="nb">p</span><span class="p">.</span><span class="nf">yield</span>
<span class="nb">p</span><span class="p">.</span><span class="nf">=</span><span class="o">==</span>
<span class="nb">p</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="ss">:call</span><span class="p">)</span></code></pre></figure>

<h1 id="method">Method</h1>

<h2 id="method-1">method</h2>

<p>You can call some methods with <code class="highlighter-rouge">method</code> method.
This method <a href="http://ruby-doc.org/core-2.1.4/Method.html">returns</a> <code class="highlighter-rouge">Method</code> class.
And after that you‚Äôre just calling this object like simple proc object:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># 'method' method</span>
<span class="n">sin_method</span> <span class="o">=</span> <span class="no">Math</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="ss">:sin</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="mi">10</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin_method</span><span class="p">)</span>

<span class="c1"># lambda style</span>
<span class="n">sin_method</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="no">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
<span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="mi">10</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin_method</span><span class="p">)</span></code></pre></figure>

<h1 id="block">Block</h1>

<h2 id="empty-block">Empty block</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&gt;&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">map</span>
<span class="c1"># =&gt; #&lt;Enumerator: [1, 2, 3]:map&gt;</span>

<span class="c1"># or</span>
<span class="o">&gt;&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="kp">nil</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Enumerator: [1, 2, 3]:map&gt;</span></code></pre></figure>

<p>You can send <code class="highlighter-rouge">&amp;nil</code> as an empty block.</p>

<h1 id="conclusions">Conclusions</h1>

<p>That‚Äôs all. I hope it‚Äôll be useful for you. In next part we‚Äôre gonna talking about:</p>

<ul>
  <li>Special values in ruby world</li>
  <li>Symbol</li>
  <li>Array</li>
  <li>Hash</li>
  <li>Range</li>
</ul>

<p>Happy hacking! üöÄ</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/09/20/adding-domain-for-your-github-project/">
        Adding domain for your github project
      </a>
    </h1>

    <span class="post-date">20 Sep 2016</span>

    <p>I have a problem. Each time I want add domain to my custom github project
I forget what I should do exactly. That‚Äôs why I want to post this SO answer in my blog.
I hope it would helpful not only for me.</p>

<p>To Setup a custom domain for your <code class="highlighter-rouge">gh-pages</code> project repo that handles
<code class="highlighter-rouge">www.yourdomain.com</code> and <code class="highlighter-rouge">yourdomain.com</code> (assumes you already have a <code class="highlighter-rouge">gh-pages</code>
branch on your repo) you need this:</p>

<ol>
  <li>From your project repo, <code class="highlighter-rouge">gh-pages</code> branch. Create a <code class="highlighter-rouge">CNAME</code> file with the contents <code class="highlighter-rouge">yourdomain.com</code>.</li>
  <li>In your DNS manager, setup two <code class="highlighter-rouge">CNAME</code> records. One for the root apex (<code class="highlighter-rouge">@</code>) and one for <code class="highlighter-rouge">www</code>. Both point to <code class="highlighter-rouge">YOURusername.github.io</code>. If your DNS provider does <strong>NOT</strong> support <code class="highlighter-rouge">ALIAS</code> records on the root apex (<code class="highlighter-rouge">@</code>), simply create <code class="highlighter-rouge">A</code> records that point to <code class="highlighter-rouge">192.30.252.153</code> and <code class="highlighter-rouge">192.30.252.154</code>.</li>
</ol>

<p>After that wait til your name servers update:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dig yourdomain.com +nostats +nocomments +nocmd
</code></pre>
</div>

<p><br /></p>

<p>Original link: <a href="http://stackoverflow.com/a/9123911">stackoverflow.com/a/9123911</a></p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#github"><span>github</span></a>
        </li>
      
        <li>
          <a href="/tags/#domain"><span>domain</span></a>
        </li>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/05/21/preview-hanami-emails-in-browser/">
        Preview hanami emails in browser
      </a>
    </h1>

    <span class="post-date">21 May 2016</span>

    <p>Sometimes you need to preview your emails in development enviroment. 
For this you can use use <a href="https://github.com/ryanb/letter_opener">letter_opener</a> gem.
Because hanami uses <a href="https://github.com/mikel/mail">mail</a> gem, <code class="highlighter-rouge">letter_opener</code> integration will be easy.
Firstly you need add gem to your Gemfile:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s2">"letter_opener"</span><span class="p">,</span> <span class="ss">group: :development</span></code></pre></figure>

<p>Secondly you need add new delivery method to your <code class="highlighter-rouge">lib/repository_name.rb</code> file:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"letter_opener"</span>
<span class="no">Hanami</span><span class="o">::</span><span class="no">Mailer</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="n">delivery</span> <span class="k">do</span>
    <span class="n">development</span> <span class="no">LetterOpener</span><span class="o">::</span><span class="no">DeliveryMethod</span><span class="p">,</span> <span class="ss">location: </span><span class="no">Hanami</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'tmp/letter_opener'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">.</span><span class="nf">load!</span></code></pre></figure>

<p>After that when you deliver your email, <code class="highlighter-rouge">letter_opener</code> will generate html files that users will see in <code class="highlighter-rouge">tmp/letter_opener</code> directory.</p>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#hanami"><span>hanami</span></a>
        </li>
      
        <li>
          <a href="/tags/#mail"><span>mail</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/05/20/develop-api-with-roda/">
        Building your rails API with roda
      </a>
    </h1>

    <span class="post-date">20 May 2016</span>

    <h2 id="introduction">Introduction</h2>

<p>Sometimes you need to build API serveice in your rails application.
Of course you can use popular solutions as <a href="http://www.ruby-grape.org">grape</a> or <a href="https://github.com/rails-api/rails-api">rails-api</a> gems.
And also you can find real examples in <a href="https://github.com/gitlabhq/gitlabhq/tree/master/lib/api">gitlab</a> or <a href="https://github.com/rubygems/rubygems.org/tree/master/app/controllers/api">rubygems</a> projects.</p>

<p>But today I‚Äôm going to tell you about other framework. It‚Äôs <a href="http://roda.jeremyevans.net">roda</a>.
Roda was created by <a href="https://github.com/jeremyevans">Jeremy Evans</a> and it‚Äôs fast and simple ruby routing framework.
So why should you take a look on it?</p>

<p>There‚Äôs a list of advantages of this framework:</p>

<ol>
  <li>Fast;</li>
  <li>Simple;</li>
  <li>Roda provides simple way to working with big count of different plugins;</li>
  <li>You can use any architecture with it;</li>
</ol>

<p>So I mentioned that roda is fast. If you want to verify this, just check <a href="https://github.com/luislavena/bench-micro">this benchmark repository</a> and you‚Äôll see that roda is really fast.
For example, I run benchmarks on locally and get this result:</p>

<figure class="highlight"><pre><code class="language-code" data-lang="code">Framework            Requests/sec  % from best
----------------------------------------------
mustermann                9389.60       100.0%
roda                      9252.03       98.53%
rack                      9246.16       98.47%
hanami-router             6240.81       66.47%
sinatra                   2935.63       31.26%
grape                     2512.17       26.75%</code></pre></figure>

<h2 id="integration">Integration</h2>

<p>Roda based on rack. That‚Äôs why this integration with rails will be very simple.
Firstly you need to add roda gem to your gemfile:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">'roda'</span></code></pre></figure>

<p>Secondly you need to create simple roda application.
Note that you need to use <code class="highlighter-rouge">json</code> and <code class="highlighter-rouge">all_verbs</code> plugins.
The first one needs to JSON responce and the second one provides all REST methods for your application (like <code class="highlighter-rouge">put</code>, <code class="highlighter-rouge">patch</code>, etc).
I puted my roda application in to <code class="highlighter-rouge">lib/api/base.rb</code> path but you can use whatever you waht.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/api/base.rb</span>
<span class="nb">require</span> <span class="s1">'roda'</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="k">module</span> <span class="nn">API</span>
  <span class="k">class</span> <span class="nc">Base</span> <span class="o">&lt;</span> <span class="no">Roda</span>
    <span class="n">plugin</span> <span class="ss">:json</span>
    <span class="n">plugin</span> <span class="ss">:all_verbs</span>

    <span class="n">route</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
      <span class="n">r</span><span class="p">.</span><span class="nf">on</span> <span class="s2">"v1"</span> <span class="k">do</span>
        <span class="n">r</span><span class="p">.</span><span class="nf">get</span> <span class="s1">'hello'</span> <span class="k">do</span>
          <span class="p">{</span> <span class="ss">hello: :world</span> <span class="p">}</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>After that you need to mount your application in <code class="highlighter-rouge">config/routes.rb</code>.
This is done as well as any other rack application:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config/routes.rb</span>
<span class="nb">require</span> <span class="s1">'./lib/api/base'</span>
<span class="n">mount</span> <span class="no">API</span><span class="o">::</span><span class="no">Base</span> <span class="o">=&gt;</span> <span class="s1">'/api'</span></code></pre></figure>

<p>And the last part, we need to split our application to different modules with different logic and routes.
For this we have to create required module. In an example I created <code class="highlighter-rouge">Users</code> module with all REST routes:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/api/users.rb</span>
<span class="k">module</span> <span class="nn">API</span>
  <span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">Roda</span>
    <span class="n">plugin</span> <span class="ss">:json</span>
    <span class="n">plugin</span> <span class="ss">:all_verbs</span>

    <span class="n">route</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
      <span class="n">r</span><span class="p">.</span><span class="nf">is</span> <span class="s1">'users'</span> <span class="k">do</span>
        <span class="n">r</span><span class="p">.</span><span class="nf">get</span> <span class="k">do</span>
          <span class="p">{</span> <span class="ss">users: </span><span class="no">User</span><span class="p">.</span><span class="nf">last</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">end</span>

        <span class="n">r</span><span class="p">.</span><span class="nf">post</span> <span class="k">do</span>
          <span class="p">{</span> <span class="ss">user: </span><span class="no">User</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="n">r</span><span class="p">.</span><span class="nf">is</span> <span class="s1">'users/:id'</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
        <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="n">r</span><span class="p">.</span><span class="nf">get</span> <span class="k">do</span>
          <span class="p">{</span> <span class="ss">user: </span><span class="n">user</span><span class="p">}</span>
        <span class="k">end</span>

        <span class="n">r</span><span class="p">.</span><span class="nf">patch</span> <span class="k">do</span>
          <span class="p">{</span> <span class="ss">user: </span><span class="s1">'updated'</span> <span class="p">}</span>
        <span class="k">end</span>

        <span class="n">r</span><span class="p">.</span><span class="nf">delete</span> <span class="k">do</span>
          <span class="p">{</span> <span class="ss">user: </span><span class="s1">'deleted'</span> <span class="p">}</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Finnaly you need to mount our module to roda application. It is very simple too.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/api/base.rb</span>
<span class="nb">require</span> <span class="s1">'roda'</span>
<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'users'</span>

<span class="k">module</span> <span class="nn">API</span>
  <span class="k">class</span> <span class="nc">Base</span> <span class="o">&lt;</span> <span class="no">Roda</span>
    <span class="n">plugin</span> <span class="ss">:json</span>
    <span class="n">plugin</span> <span class="ss">:all_verbs</span>

    <span class="n">route</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
      <span class="n">r</span><span class="p">.</span><span class="nf">on</span> <span class="s2">"v1"</span> <span class="k">do</span>
        <span class="n">r</span><span class="p">.</span><span class="nf">run</span> <span class="no">API</span><span class="o">::</span><span class="no">Users</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>That‚Äôs all. Now we have a simple roda API application which integrated to our rails app.</p>

<h2 id="problems--future">Problems / future</h2>

<p>In the last part I want to list problems and ideas what I want to solve in future.</p>

<ol>
  <li>Roda doesn‚Äôt have a swagger integrating from the box. Now I‚Äôm thinking about using swagger-block gem for it.</li>
  <li>Also roda doesn‚Äôt typecast your params. I know that grape uses virtus gem for this. And this feature you should realize by youself too.</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>On this blog post I wanted to show you that you‚Äôre not limited only to popular API server gems.
As you can see roda have amazing ideas and properties such as modulatiry, simplicity, speed and stability.
Also this framework has a simple way to integration in to your rails application.</p>

<p>Happy hacking! emoji</p>

<h2 id="further-reading">Further reading</h2>
<ul>
  <li><a href="http://roda.jeremyevans.net/why.html">Why roda?</a></li>
  <li><a href="http://rodauth.jeremyevans.net">Rodauth</a>. Authentication framework based on roda.</li>
</ul>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#rails"><span>rails</span></a>
        </li>
      
        <li>
          <a href="/tags/#roda"><span>roda</span></a>
        </li>
      
        <li>
          <a href="/tags/#api"><span>api</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/05/14/middleman-add-title-anchors/">
        Adding anchors to your middleman project
      </a>
    </h1>

    <span class="post-date">14 May 2016</span>

    <p>All people love anchors. It‚Äôs helpful, cool and practical. If you
want to add anchors to you middleman project you need to follow the
following steps.</p>

<p>First: we need to create a new renderer class. In this class we‚Äôll
put <code class="highlighter-rouge">&lt;a&gt;</code> tag inside <code class="highlighter-rouge">&lt;h&gt;</code> tag. Also, we‚Äôll realize anchor svg in
guthub style:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'middleman-core/renderers/redcarpet'</span>

<span class="k">class</span> <span class="nc">GithubStyleTitles</span> <span class="o">&lt;</span> <span class="no">Middleman</span><span class="o">::</span><span class="no">Renderers</span><span class="o">::</span><span class="no">MiddlemanRedcarpetHTML</span>
  <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="vi">@headers</span> <span class="o">||=</span> <span class="p">[]</span>
    <span class="n">permalink</span> <span class="o">=</span> <span class="n">title</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/\W+/</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@headers</span><span class="p">.</span><span class="nf">include?</span> <span class="n">permalink</span>
      <span class="n">permalink</span> <span class="o">+=</span> <span class="s1">'_1'</span>
      <span class="n">permalink</span> <span class="o">=</span> <span class="n">permalink</span><span class="p">.</span><span class="nf">succ</span> <span class="k">while</span> <span class="vi">@headers</span><span class="p">.</span><span class="nf">include?</span> <span class="n">permalink</span>
    <span class="k">end</span>
    <span class="vi">@headers</span> <span class="o">&lt;&lt;</span> <span class="n">permalink</span>

    <span class="sx">%(
      &lt;h#{level} id=\"#{permalink}\" class="title"&gt;
        &lt;a name="#{permalink}" class="anchor" href="##{permalink}"&gt;&lt;/a&gt;
        #{title}
      &lt;/h#{level}&gt;
    )</span>
  <span class="k">end</span>

<span class="kp">private</span>

  <span class="k">def</span> <span class="nf">anchor_svg</span>
     <span class="o">&lt;&lt;-</span><span class="no">eos</span><span class="sh">
       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
</span><span class="no">     eos</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>After that we need to call our renderer in <code class="highlighter-rouge">:markdown</code> configuration:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="ss">fenced_code_blocks: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">smartypants: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">renderer: </span><span class="no">GithubStyleTitles</span></code></pre></figure>

<p>And the last step: we need to stylize our anchor with css:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.anchor</span> <span class="p">{</span>
  <span class="nl">padding-right</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
  <span class="nl">margin-left</span><span class="p">:</span> <span class="m">-18px</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.title</span> <span class="nc">.anchor</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>After all this steps we‚Äôll get something like this:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1147484/15233483/08d207ae-18ba-11e6-92a4-ed5bad2ab816.gif" alt="gif" /></p>

<p>I hope it will be useful to you  as well as for me at one time.</p>

<p>Happy hacking! üíö</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#blog"><span>blog</span></a>
        </li>
      
        <li>
          <a href="/tags/#middleman"><span>middleman</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/03/16/simple-hanami-auth/">
        Simplest way to authenticate user in hanami app
      </a>
    </h1>

    <span class="post-date">16 Mar 2016</span>

    <p>If you need the simplest and easiest way to adding authentication logic in your <a href="http://hanamirb.org">hanami</a> app (to admin app for example) you always can use <a href="https://github.com/rack/rack/blob/master/lib/rack/auth/basic.rb"><code class="highlighter-rouge">Rack::Auth::Basic</code></a> class.</p>

<p>For this you need to add following lines of code to your <code class="highlighter-rouge">controller.prepare</code> configuration block:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># apps/admin/application.rb</span>

<span class="n">controller</span><span class="p">.</span><span class="nf">prepare</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="c1"># some code</span>

  <span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Auth</span><span class="o">::</span><span class="no">Basic</span><span class="p">,</span> <span class="s1">'Message'</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
    <span class="n">username</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">'password'</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Happy authenticating!</p>

<p><strong>P.S.:</strong> also if you need something more complicated you can reed <a href="https://discuss.hanamirb.org/t/authentication-for-lotus-app/178">this</a> thread on hanami forum.</p>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#hanami"><span>hanami</span></a>
        </li>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/15/stackprof-with-minitest/">
        Profiling minitest examples with Stackprof
      </a>
    </h1>

    <span class="post-date">15 Dec 2015</span>

    <p>Today I read a nice blog post by Kir Shatrov about <a href="http://blog.iempire.ru/2015/10/13/profiling-specs">Profiling RSpec examples with Stackprof</a>
and I wondered if I could repeat this trick with minitest? This question is very important for me
because I ofen use minitest for my job and OSS projects. Also a lot of cool projects use minitest
(for example, sidekiq, rails, lotus, etc).</p>

<p>In reality, to do that in minitest as easy as in RSpec, and the only difference is that you need
to install a separate gem.</p>

<ol>
  <li>Firstly you have to install <a href="https://github.com/splattael/minitest-around">minitest-around</a> gem;</li>
  <li>And secondly you have to add this block of code to your <code class="highlighter-rouge">test_helper</code> file;</li>
</ol>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/test_helper.rb</span>
<span class="nb">require</span> <span class="s1">'stackprof'</span>
<span class="nb">require</span> <span class="s1">'minitest/around/spec'</span>

<span class="k">class</span> <span class="nc">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">around</span><span class="p">(</span><span class="o">&amp;</span><span class="n">example</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">"path/to/repo/tmp/stackprof.dump"</span>
    <span class="no">StackProf</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="ss">mode: :object</span><span class="p">,</span> <span class="ss">out: </span><span class="n">path</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">example</span><span class="p">.</span><span class="nf">call</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Happy profiling!</p>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#profiling"><span>profiling</span></a>
        </li>
      
        <li>
          <a href="/tags/#minitest"><span>minitest</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/13/render-ruby-block-in-layout-file/">
        Rendering ruby block result in layout file
      </a>
    </h1>

    <span class="post-date">13 Dec 2015</span>

    <p>If you want to render some result of ruby block in your layout file, you may run into some problems.
For example, your result may be repeated on page or you can get something worse.</p>

<p>let‚Äôs assume we have these methods:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">add_to_head</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="vi">@head_html</span> <span class="o">||=</span> <span class="p">[]</span>
  <span class="vi">@head_html</span> <span class="o">&lt;&lt;</span> <span class="n">block</span> <span class="k">if</span> <span class="nb">block_given?</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">display_custom_head</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="vi">@head_html</span>
  <span class="vi">@head_html</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:call</span><span class="p">).</span><span class="nf">join</span>
<span class="k">end</span></code></pre></figure>

<p>Of cource you can use <code class="highlighter-rouge">captire</code> method from <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/CaptureHelper.html#method-i-capture">rails</a> and <a href="https://github.com/sinatra/sinatra-contrib#common-extensions">sinatra-contrib</a> librares.
But what will you do if you can‚Äôt use these methods or you need something easier?</p>

<p>I faced a similar problem (<a href="https://github.com/mperham/sidekiq/pull/2270">for example, in sidekiq</a>) and I used own <code class="highlighter-rouge">capture</code> method for layout files.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">block</span><span class="p">.</span><span class="nf">call</span>
  <span class="nb">eval</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="nf">binding</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>And after that we can update our <code class="highlighter-rouge">display_custom_head</code> method:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">display_custom_head</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="vi">@head_html</span>
  <span class="vi">@head_html</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">block</span><span class="o">|</span> <span class="n">capture</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="p">}.</span><span class="nf">join</span>
<span class="k">end</span></code></pre></figure>

<p>I hope it will be useful to you  as well as for me at one time.</p>

<p>Happy hacking!</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#layout"><span>layout</span></a>
        </li>
      
        <li>
          <a href="/tags/#bicycle"><span>bicycle</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>

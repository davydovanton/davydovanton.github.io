<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Anton Davydov &middot; Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/base.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- SEO -->
  

  <link rel="author" href="https://plus.google.com/u/0/104253015484296728880"/>
</head>


  <body>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Simple blog where I'll write about ruby, my ideas and technologies which I love<br><a href="https://twitter.com/anton_davydov" target="_blank">@anton_davydov</a></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/tags/">All tags</a>
        
      
    

    <a class="sidebar-nav-item" href="https://github.com/davydovanton">GitHub</a>
    <a class="sidebar-nav-item" href="https://twitter.com/anton_davydov">Twitter</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2016. All rights reserved.
    </p>
  </div>
</div>

    <div class="yandex_metrica">
<!-- Yandex.Metrika counter --><script type="text/javascript">var yaParams = {/*–ó–¥–µ—Å—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–∑–∏—Ç–∞*/};</script><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter23652886 = new Ya.Metrika({id:23652886, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true,params:window.yaParams||{ }}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/23652886" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Anton Davydov</a>
            <small>Blog</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/05/14/middleman-add-title-anchors/">
        Adding anchors to your middleman project
      </a>
    </h1>

    <span class="post-date">14 May 2016</span>

    <p>All people love anchors. It‚Äôs helpful, cool and practical. If you
want to add anchors to you middleman project you need to follow the
following steps.</p>

<p>First: we need to create a new renderer class. In this class we‚Äôll
put <code class="highlighter-rouge">&lt;a&gt;</code> tag inside <code class="highlighter-rouge">&lt;h&gt;</code> tag. Also, we‚Äôll realize anchor svg in
guthub style:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'middleman-core/renderers/redcarpet'</span>

<span class="k">class</span> <span class="nc">GithubStyleTitles</span> <span class="o">&lt;</span> <span class="no">Middleman</span><span class="o">::</span><span class="no">Renderers</span><span class="o">::</span><span class="no">MiddlemanRedcarpetHTML</span>
  <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="vi">@headers</span> <span class="o">||=</span> <span class="p">[]</span>
    <span class="n">permalink</span> <span class="o">=</span> <span class="n">title</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/\W+/</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@headers</span><span class="p">.</span><span class="nf">include?</span> <span class="n">permalink</span>
      <span class="n">permalink</span> <span class="o">+=</span> <span class="s1">'_1'</span>
      <span class="n">permalink</span> <span class="o">=</span> <span class="n">permalink</span><span class="p">.</span><span class="nf">succ</span> <span class="k">while</span> <span class="vi">@headers</span><span class="p">.</span><span class="nf">include?</span> <span class="n">permalink</span>
    <span class="k">end</span>
    <span class="vi">@headers</span> <span class="o">&lt;&lt;</span> <span class="n">permalink</span>

    <span class="sx">%(
      &lt;h#{level} id=\"#{permalink}\"&gt;&lt;a name="#{permalink}" class="anchor" href="##{permalink}"&gt;&lt;/a&gt;#{title}&lt;/h#{level}&gt;
    )</span>
  <span class="k">end</span>

<span class="kp">private</span>

  <span class="k">def</span> <span class="nf">anchor_svg</span>
     <span class="o">&lt;&lt;-</span><span class="no">eos</span><span class="sh">
       &lt;svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"&gt;
       &lt;path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"&gt;&lt;/path&gt;
       &lt;/svg&gt;
</span><span class="no">     eos</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>After that we need to call our renderer in <code class="highlighter-rouge">:markdown</code> configuration:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="ss">fenced_code_blocks: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">smartypants: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">renderer: </span><span class="no">GithubStyleTitles</span></code></pre></figure>

<p>And the last step: we need to stylize our anchor with css:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.docs-content</span> <span class="nc">.anchor</span> <span class="p">{</span>
  <span class="nl">padding-right</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
  <span class="nl">margin-left</span><span class="p">:</span> <span class="m">-18px</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.docs-content</span> <span class="nt">h1</span><span class="nd">:hover</span> <span class="nc">.anchor</span><span class="o">,</span>
<span class="nc">.docs-content</span> <span class="nt">h2</span><span class="nd">:hover</span> <span class="nc">.anchor</span><span class="o">,</span>
<span class="nc">.docs-content</span> <span class="nt">h3</span><span class="nd">:hover</span> <span class="nc">.anchor</span><span class="o">,</span>
<span class="nc">.docs-content</span> <span class="nt">h4</span><span class="nd">:hover</span> <span class="nc">.anchor</span><span class="o">,</span>
<span class="nc">.docs-content</span> <span class="nt">h5</span><span class="nd">:hover</span> <span class="nc">.anchor</span><span class="o">,</span>
<span class="nc">.docs-content</span> <span class="nt">h6</span><span class="nd">:hover</span> <span class="nc">.anchor</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>After all this steps we‚Äôll get something like this:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1147484/15233483/08d207ae-18ba-11e6-92a4-ed5bad2ab816.gif" alt="gif" /></p>

<p>I hope it will be useful to you  as well as for me at one time.</p>

<p>Happy hacking! üíö</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#blog"><span>blog</span></a>
        </li>
      
        <li>
          <a href="/tags/#middleman"><span>middleman</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2016/03/16/simple-hanami-auth/">
        Simplest way to authenticate user in hanami app
      </a>
    </h1>

    <span class="post-date">16 Mar 2016</span>

    <p>If you need the simplest and easiest way to adding authentication logic in your <a href="http://hanamirb.org">hanami</a> app (to admin app for example) you always can use <a href="https://github.com/rack/rack/blob/master/lib/rack/auth/basic.rb"><code class="highlighter-rouge">Rack::Auth::Basic</code></a> class.</p>

<p>For this you need to add following lines of code to your <code class="highlighter-rouge">controller.prepare</code> configuration block:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># apps/admin/application.rb</span>

<span class="n">controller</span><span class="p">.</span><span class="nf">prepare</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="c1"># some code</span>

  <span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Auth</span><span class="o">::</span><span class="no">Basic</span><span class="p">,</span> <span class="s1">'Message'</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
    <span class="n">username</span> <span class="o">==</span> <span class="s1">'admin'</span> <span class="o">&amp;&amp;</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">'password'</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Happy authenticating!</p>

<p><strong>P.S.:</strong> also if you need something more complicated you can reed <a href="https://discuss.hanamirb.org/t/authentication-for-lotus-app/178">this</a> thread on hanami forum.</p>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#hanami"><span>hanami</span></a>
        </li>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/15/stackprof-with-minitest/">
        Profiling minitest examples with Stackprof
      </a>
    </h1>

    <span class="post-date">15 Dec 2015</span>

    <p>Today I read a nice blog post by Kir Shatrov about <a href="http://blog.iempire.ru/2015/10/13/profiling-specs">Profiling RSpec examples with Stackprof</a>
and I wondered if I could repeat this trick with minitest? This question is very important for me
because I ofen use minitest for my job and OSS projects. Also a lot of cool projects use minitest
(for example, sidekiq, rails, lotus, etc).</p>

<p>In reality, to do that in minitest as easy as in RSpec, and the only difference is that you need
to install a separate gem.</p>

<ol>
  <li>Firstly you have to install <a href="https://github.com/splattael/minitest-around">minitest-around</a> gem;</li>
  <li>And secondly you have to add this block of code to your <code class="highlighter-rouge">test_helper</code> file;</li>
</ol>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test/test_helper.rb</span>
<span class="nb">require</span> <span class="s1">'stackprof'</span>
<span class="nb">require</span> <span class="s1">'minitest/around/spec'</span>

<span class="k">class</span> <span class="nc">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">around</span><span class="p">(</span><span class="o">&amp;</span><span class="n">example</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">"path/to/repo/tmp/stackprof.dump"</span>
    <span class="no">StackProf</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="ss">mode: :object</span><span class="p">,</span> <span class="ss">out: </span><span class="n">path</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">example</span><span class="p">.</span><span class="nf">call</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Happy profiling!</p>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#profiling"><span>profiling</span></a>
        </li>
      
        <li>
          <a href="/tags/#minitest"><span>minitest</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/13/render-ruby-block-in-layout-file/">
        Rendering ruby block result in layout file
      </a>
    </h1>

    <span class="post-date">13 Dec 2015</span>

    <p>If you want to render some result of ruby block in your layout file, you may run into some problems.
For example, your result may be repeated on page or you can get something worse.</p>

<p>let‚Äôs assume we have these methods:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">add_to_head</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="vi">@head_html</span> <span class="o">||=</span> <span class="p">[]</span>
  <span class="vi">@head_html</span> <span class="o">&lt;&lt;</span> <span class="n">block</span> <span class="k">if</span> <span class="nb">block_given?</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">display_custom_head</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="vi">@head_html</span>
  <span class="vi">@head_html</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:call</span><span class="p">).</span><span class="nf">join</span>
<span class="k">end</span></code></pre></figure>

<p>Of cource you can use <code class="highlighter-rouge">captire</code> method from <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/CaptureHelper.html#method-i-capture">rails</a> and <a href="https://github.com/sinatra/sinatra-contrib#common-extensions">sinatra-contrib</a> librares.
But what will you do if you can‚Äôt use these methods or you need something easier?</p>

<p>I faced a similar problem (<a href="https://github.com/mperham/sidekiq/pull/2270">for example, in sidekiq</a>) and I used own <code class="highlighter-rouge">capture</code> method for layout files.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">block</span><span class="p">.</span><span class="nf">call</span>
  <span class="nb">eval</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="nf">binding</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>And after that we can update our <code class="highlighter-rouge">display_custom_head</code> method:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">display_custom_head</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="vi">@head_html</span>
  <span class="vi">@head_html</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">block</span><span class="o">|</span> <span class="n">capture</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="p">}.</span><span class="nf">join</span>
<span class="k">end</span></code></pre></figure>

<p>I hope it will be useful to you  as well as for me at one time.</p>

<p>Happy hacking!</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#layout"><span>layout</span></a>
        </li>
      
        <li>
          <a href="/tags/#bicycle"><span>bicycle</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/11/14/ignore-file-lines-in-git/">
        Ignore file lines in git
      </a>
    </h1>

    <span class="post-date">14 Nov 2015</span>

    <p>For example, you have this code and you want to ignore in git lines which contain <code class="highlighter-rouge">username</code> and <code class="highlighter-rouge">password</code> values:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">ssh_connect</span>
  <span class="n">username</span> <span class="o">=</span> <span class="s2">"root"</span> <span class="c1"># ignore this line</span>
  <span class="n">password</span> <span class="o">=</span> <span class="s2">"password"</span> <span class="c1"># ignore this line too</span>
  <span class="n">ip</span> <span class="o">=</span> <span class="s2">"192.168.1.1"</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<p>To ignore some special lines in git you need to:</p>

<ol>
  <li>Create a <code class="highlighter-rouge">.gitattributes</code> in your repository (remember that <code class="highlighter-rouge">.gitattributes</code> will be committed into the repository, if you don‚Äôt want that, add it to <code class="highlighter-rouge">.git/info/attributes</code>)</li>
  <li>Add <code class="highlighter-rouge">*.rb filter=ignoreline</code> (run filter named ignoreline on all <code class="highlighter-rouge">*.rb</code> files)</li>
  <li>Now, we need to define ignoreline filter in <code class="highlighter-rouge">.gitconfig</code></li>
  <li><code class="highlighter-rouge">git config --global filter.ignoreline.clean "sed '/#ignoreline$/'d"</code> (delete theses lines)</li>
  <li><code class="highlighter-rouge">git config --global filter.ignoreline.smudge cat</code> (do nothing when pulling file from the repository)</li>
</ol>

<p>And then, you can ignore some lines using <code class="highlighter-rouge">#ignoreline</code> comment:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">ssh_connect</span>
  <span class="n">username</span> <span class="o">=</span> <span class="s2">"root"</span> <span class="c1">#ignoreline</span>
  <span class="n">password</span> <span class="o">=</span> <span class="s2">"password"</span> <span class="c1">#ignoreline</span>
  <span class="n">ip</span> <span class="o">=</span> <span class="s2">"192.168.1.1"</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<p>Happy hacking!</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
        <li>
          <a href="/tags/#git"><span>git</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/11/01/write-simple-scheme-interpreter-on-ruby/">
        Write simple scheme interpreter on ruby
      </a>
    </h1>

    <span class="post-date">01 Nov 2015</span>

    <p><strong>TL;DR:</strong> <a href="https://github.com/davydovanton/rlisp">github repo</a></p>

<p>Every developer has a moment in his life where he wants to write his own programming language.
In this article, I want to show you how to do this for a simple lisp compiler.</p>

<h2 id="why-scheme-and-lisp">Why scheme and lisp?</h2>
<p>Firstly, lisp is very simple for create and for understanding.
Lisp (<em>LISt Processor</em>) is a family of languages which is based on the idea of <a href="http://www.wikiwand.com/en/S-expression">S-expressions</a>.
<a href="http://www.wikiwand.com/en/S-expression">S-Expression</a> are needed for data representation and may consist of atoms (numbers, symbols, boolean expressions) or are the expression of the form <code class="highlighter-rouge">(x . y)</code> where <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> are <a href="http://www.wikiwand.com/en/S-expression">s-expressions</a>.
This expression may be formed as lists (<code class="highlighter-rouge">(1 . ( 2 . 3))</code> this equals <code class="highlighter-rouge">(1 2 3)</code>) and trees (<code class="highlighter-rouge">((1 . (2 . 3)) . (4 . 5))</code>).</p>

<p>Secondly, after creating interpreter you can better understand the language (the author fully understood the environment idea).
Also you can understand the main idea of compilers and interpreters.</p>

<p>Now let‚Äôs begin our journey into the world of compilers and interpreters so that we can write a simple scheme interpreter.</p>

<h2 id="main-idea">Main idea</h2>
<p>Our language will contain two parts: a parser which translates the string to <a href="http://www.wikiwand.com/en/Abstract_syntax_tree">AST</a> and <code class="highlighter-rouge">eval</code> function.
This function will take the <a href="http://www.wikiwand.com/en/Abstract_syntax_tree">AST</a> with envariement value and will return the result of the code.</p>

<p>Schematically, it looks like this:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">code(string) =&gt; parse function =&gt; AST =&gt; eval function =&gt; result</code></pre></figure>

<h2 id="first-step-parser">First step. Parser.</h2>
<p>To begin, let‚Äôs define what we want to get.
For example, we have a string <code class="highlighter-rouge">'(+ 1 1 1)'</code>.
What should our parser return? What kind of data structure should we receive? I think, that an array would be correct.</p>

<p>Let write simple test code:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">program</span> <span class="o">=</span> <span class="s1">'(+ 1 1 1)'</span>
<span class="n">lisp</span> <span class="o">=</span> <span class="no">Lisp</span><span class="p">.</span><span class="nf">new</span>
<span class="n">lisp</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">program</span><span class="p">)</span> <span class="o">==</span> <span class="p">[:</span><span class="o">+</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></code></pre></figure>

<p>As you can see, this is a simple code, so I just displayed <code class="highlighter-rouge">parse</code> method code:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Lisp</span>
  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
    <span class="n">tokenize</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
    <span class="n">chars</span>
      <span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/\s\s+/</span><span class="p">,</span> <span class="s1">' '</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'('</span><span class="p">,</span> <span class="s1">' ( '</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">')'</span><span class="p">,</span> <span class="s1">' ) '</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">token</span><span class="o">|</span> <span class="n">atom</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">compact</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="sr">/\.\d+/</span><span class="p">]</span>
      <span class="n">token</span><span class="p">.</span><span class="nf">to_f</span>
    <span class="k">elsif</span> <span class="n">token</span> <span class="o">==</span> <span class="s1">'('</span> <span class="o">||</span> <span class="n">token</span> <span class="o">==</span> <span class="s1">')'</span>
      <span class="kp">nil</span>
    <span class="k">elsif</span> <span class="n">token</span><span class="p">[</span><span class="sr">/\d+/</span><span class="p">]</span>
      <span class="n">token</span><span class="p">.</span><span class="nf">to_i</span>
    <span class="k">else</span>
      <span class="n">token</span><span class="p">.</span><span class="nf">to_sym</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>As you know, in lisp you can write your code with nested operators, for example - <code class="highlighter-rouge">(+ (* 2 2) (- 5 3))</code>.
And this code will return 6.</p>

<p>When we use our parser for this code, the result is not quite what we need, so let‚Äôs update our test code:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">program</span> <span class="o">=</span> <span class="s1">'(+ (* (1 2) 3) 4)'</span>
<span class="n">lisp</span> <span class="o">=</span> <span class="no">Lisp</span><span class="p">.</span><span class="nf">new</span>
<span class="n">lisp</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">program</span><span class="p">)</span> <span class="o">==</span> <span class="p">[:</span><span class="o">+</span><span class="p">,</span> <span class="p">[:</span><span class="o">*</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">]</span></code></pre></figure>

<p>As you might guess, the most obvious way to fix our code is to call <code class="highlighter-rouge">parse</code> method in recursion and all array elements from <code class="highlighter-rouge">'('</code> to <code class="highlighter-rouge">')'</code>.
We will move to a nested array.
The code will be look loke this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Lisp</span>
  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
    <span class="n">read_from_tokens</span><span class="p">(</span><span class="n">tokenize</span><span class="p">(</span><span class="n">program</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
    <span class="n">chars</span>
      <span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/\s\s+/</span><span class="p">,</span> <span class="s1">' '</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'('</span><span class="p">,</span> <span class="s1">' ( '</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">')'</span><span class="p">,</span> <span class="s1">' ) '</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">read_from_tokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">if</span> <span class="n">tokens</span><span class="p">.</span><span class="nf">empty?</span>

    <span class="n">token</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">.</span><span class="nf">shift</span>

    <span class="k">if</span> <span class="s1">'('</span> <span class="o">==</span> <span class="n">token</span>
      <span class="n">list</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="k">while</span> <span class="n">tokens</span><span class="p">.</span><span class="nf">first</span> <span class="o">!=</span> <span class="s1">')'</span>
        <span class="n">list</span> <span class="o">&lt;&lt;</span> <span class="n">read_from_tokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
      <span class="k">end</span>
      <span class="n">tokens</span><span class="p">.</span><span class="nf">shift</span>

      <span class="n">list</span>
    <span class="k">elsif</span> <span class="s1">')'</span> <span class="o">==</span> <span class="n">token</span>
      <span class="k">raise</span> <span class="s1">'unexpected )'</span>
    <span class="k">else</span>
      <span class="n">atom</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="sr">/\.\d+/</span><span class="p">]</span>
      <span class="n">token</span><span class="p">.</span><span class="nf">to_f</span>
    <span class="k">elsif</span> <span class="n">token</span><span class="p">[</span><span class="sr">/\d+/</span><span class="p">]</span>
      <span class="n">token</span><span class="p">.</span><span class="nf">to_i</span>
    <span class="k">else</span>
      <span class="n">token</span><span class="p">.</span><span class="nf">to_sym</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>We did it! Let‚Äôs start to make <code class="highlighter-rouge">eval</code> method.</p>

<h2 id="eval-method">Eval method</h2>
<p>As I said earlier, our interpreter consists of two parts: a parser and <code class="highlighter-rouge">eval</code> function.</p>

<p>The <code class="highlighter-rouge">eval</code> function will take two arguments: an expression, <code class="highlighter-rouge">exp</code>, that we want to evaluate, and an environment, <code class="highlighter-rouge">env</code>, in which to evaluate it. An environment is a mapping from variable names to their values.
By default, eval will use a instance value that includes the names for a bunch of standard things.</p>

<p>let‚Äôs implement <code class="highlighter-rouge">@env</code> variable with <code class="highlighter-rouge">car</code>, <code class="highlighter-rouge">cdr</code> and <code class="highlighter-rouge">cons</code> functions:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">env</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:car</span>  <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|*</span><span class="n">list</span><span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">},</span>
  <span class="ss">:cdr</span>  <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|*</span><span class="n">list</span><span class="o">|</span> <span class="n">list</span><span class="p">.</span><span class="nf">drop</span> <span class="mi">1</span> <span class="p">},</span>
  <span class="ss">:cons</span> <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cell</span><span class="p">),</span> <span class="n">_</span><span class="o">|</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">cell</span> <span class="p">},</span>
<span class="p">}</span></code></pre></figure>

<p>The next step is to make <code class="highlighter-rouge">eval</code> function which will look for a match on the first element of the input array</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Lisp</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">ext</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="vi">@env</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">:car</span>   <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|*</span><span class="n">list</span><span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">},</span>
      <span class="ss">:cdr</span>   <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|*</span><span class="n">list</span><span class="o">|</span> <span class="n">list</span><span class="p">.</span><span class="nf">drop</span> <span class="mi">1</span> <span class="p">},</span>
      <span class="ss">:cons</span>  <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cell</span><span class="p">),</span> <span class="n">_</span><span class="o">|</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">cell</span> <span class="p">},</span>
    <span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="vi">@env</span><span class="p">)</span>
    <span class="n">env</span><span class="p">[</span><span class="n">exp</span><span class="p">.</span><span class="nf">first</span><span class="p">]</span><span class="o">.</span><span class="p">(</span><span class="n">exp</span><span class="p">[</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<p>Now we have a problem: what will happen when the first element of the array will be not be a symbol (integer for example) and what will be happen when we have nested functions?
I think we can add a check to the element type like this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Lisp</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">ext</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="vi">@env</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">:car</span>   <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|*</span><span class="n">list</span><span class="o">|</span> <span class="n">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">},</span>
      <span class="ss">:cdr</span>   <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|*</span><span class="n">list</span><span class="o">|</span> <span class="n">list</span><span class="p">.</span><span class="nf">drop</span> <span class="mi">1</span> <span class="p">},</span>
      <span class="ss">:cons</span>  <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cell</span><span class="p">),</span> <span class="n">_</span><span class="o">|</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">cell</span> <span class="p">},</span>
    <span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="vi">@env</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exp</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">Numeric</span>
      <span class="n">exp</span>
    <span class="k">elsif</span> <span class="n">exp</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">Symbol</span>
      <span class="n">env</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="n">code</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">)</span>
      <span class="n">args</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span> <span class="nb">eval</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="p">}</span>
      <span class="n">code</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<p>Some (eg arithmetic), we can easily add to <code class="highlighter-rouge">env</code> variable, and some do not.
Therefore, we need to extend the checking in <code class="highlighter-rouge">eval</code> function. We will add a check for function name.
For example, the code below will demonstrate <code class="highlighter-rouge">quote</code> and <code class="highlighter-rouge">if</code> functions:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="k">elsif</span> <span class="n">exp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="ss">:quote</span>
    <span class="n">exp</span><span class="p">[</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">elsif</span> <span class="n">exp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="ss">:if</span>
    <span class="n">_</span><span class="p">,</span> <span class="nb">test</span><span class="p">,</span> <span class="n">conseq</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">exp</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">test</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="p">?</span> <span class="n">conseq</span> <span class="p">:</span> <span class="n">alt</span>
    <span class="nb">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<p>The next step is to initialize <code class="highlighter-rouge">define</code> and <code class="highlighter-rouge">lambda</code> functions.
In scheme <code class="highlighter-rouge">define</code> function syntax is as follows:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">name</span>
  <span class="p">(</span><span class="nf">expression</span><span class="p">))</span></code></pre></figure>

<p>And our code must create a new key-value pair in the <code class="highlighter-rouge">env</code> hash:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="k">elsif</span> <span class="n">exp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="ss">:define</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">exp</span>
    <span class="n">env</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<p>The last function, <code class="highlighter-rouge">lambda</code> in scheme will have this syntax:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">arg1,</span> <span class="nv">arg2,</span> <span class="o">...</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">block</span> <span class="nv">of</span> <span class="nv">code</span><span class="p">))</span></code></pre></figure>

<p>The first thing that comes to mind is to return the new <code class="highlighter-rouge">lambda</code> object with a new value inside <code class="highlighter-rouge">env</code> that will serve our code:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="k">elsif</span> <span class="n">exp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="ss">:lambda</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">exp</span>
    <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span> <span class="nb">self</span><span class="p">.</span><span class="nf">eval</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">env</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="no">Hash</span><span class="p">[</span><span class="n">params</span><span class="p">.</span><span class="nf">zip</span><span class="p">(</span><span class="n">args</span><span class="p">)]))</span> <span class="p">}</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<p>As you can see, we made basic functionality of the our interpreter.
I will leave learning how to do the implement the arithmetic methods and other methods such as <code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">false</code>, <code class="highlighter-rouge">list</code>, etc up to the reader.</p>

<h2 id="repl">REPL</h2>
<p>In main REPL have really simple idea repl takes single user inputs, evaluates them, and returns the result to the user.
And all this is happens in an infinite loop:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">repl</span><span class="p">(</span><span class="n">prompt</span> <span class="o">=</span> <span class="s1">'lisp &gt;&gt; '</span><span class="p">)</span>
  <span class="k">while</span> <span class="kp">true</span>
    <span class="nb">print</span> <span class="n">prompt</span>
    <span class="n">program</span> <span class="o">=</span> <span class="nb">gets</span>

    <span class="nb">p</span> <span class="nb">eval</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">program</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>As a result, you should get something like this:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">lisp &gt;&gt; (define pi 3.14)
3.14
lisp &gt;&gt; (define circle-area (lambda (r) (* pi (* r r))))
#&lt;Proc:0x007fa6140c6cc0@lib/rlisp.rb:86 (lambda)&gt;
lisp &gt;&gt; (circle-area 11)
379.94</code></pre></figure>

<h2 id="conclusions">Conclusions</h2>
<p>Right now, we have a simple scheme interpreter.
It is easy to expand since we wrote a simple repl, and considered the basic idea of the interpreter.
In this article, we did not consider such important concepts as macros, multithreading, code optimization, work with the system, and much more.
These concepts will be discussed in future articles.</p>

<h2 id="further-reading">Further reading</h2>
<ul>
  <li>Lisp interpreter written on python (<a href="http://norvig.com/lispy.html">http://norvig.com/lispy.html</a>)</li>
  <li>Lisp interpreter written on C lang (<a href="http://www.buildyourownlisp.com">http://www.buildyourownlisp.com</a>)</li>
  <li><a href="http://www.wikiwand.com/en/Scheme_(programming_language)">http://www.wikiwand.com/en/Scheme_(programming_language)</a></li>
  <li><a href="http://www.wikiwand.com/en/S-expression">http://www.wikiwand.com/en/S-expression</a></li>
</ul>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#lisp"><span>lisp</span></a>
        </li>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#interpreters"><span>interpreters</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/10/26/get-requiest-with-custom-locale-in-your-tests/">
        Get request with custom locale in your tests
      </a>
    </h1>

    <span class="post-date">26 Oct 2015</span>

    <p>Sometimes in tests you have to set special locale for <code class="highlighter-rouge">get</code> request.
For example you want to <a href="https://github.com/mperham/sidekiq/blob/master/test/test_web.rb#L33-L50">test selecting locale language</a>.
For this you have to set locale in <code class="highlighter-rouge">'HTTP_ACCEPT_LANGUAGE'</code> variable in params hash.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">it</span> <span class="s1">'your test description'</span> <span class="k">do</span>
  <span class="n">rackenv</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'HTTP_ACCEPT_LANGUAGE'</span> <span class="o">=&gt;</span> <span class="s1">'ru,en'</span><span class="p">}</span>
  <span class="n">get</span> <span class="s1">'/'</span><span class="p">,</span> <span class="p">{},</span> <span class="n">rackenv</span>

  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span></code></pre></figure>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#test"><span>test</span></a>
        </li>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/04/05/ruby-memory-profiller-tools/">
        Memory profiler tools for ruby
      </a>
    </h1>

    <span class="post-date">05 Apr 2015</span>

    <p>Memory profiler tools for ruby It so happened that I was need know how much ruby objects created
for each call sidekiq <code class="highlighter-rouge">perform_async</code> method
(<a href="https://github.com/mperham/sidekiq/pull/2288">mperham/sidekiq#2288</a>).
That‚Äôs why I decided to create list with tools which helps you to know all required information.</p>

<h2 id="ruby-gc">1. Ruby GC</h2>
<p>Sam Saffron has written great post, in which he talk about ruby garbage collector and wonderful
<code class="highlighter-rouge">GC.start</code> method which returns data hash:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">2</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="no">GC</span><span class="p">.</span><span class="nf">stat</span>
<span class="c1"># =&gt; {:count=&gt;21,¬†:heap_allocated_pages=&gt;236,¬†:heap_sorted_length=&gt;237,¬†:heap_allocatable_pages=&gt;0,¬†:heap_available_slots=&gt;96193,¬†:heap_live_slots=&gt;95354,¬†‚Ä¶ }</span></code></pre></figure>

<p>Also author mentions a <code class="highlighter-rouge">ObjectSpace</code> module that lets you know information about object/memory management.
For example you can easily know general number of created objects. For this you need write this code:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="mi">2</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="no">ObjectSpace</span><span class="p">.</span><span class="nf">count_objects</span><span class="p">[</span><span class="ss">:TOTAL</span><span class="p">]</span>
<span class="c1"># =&gt; 96193</span></code></pre></figure>

<h2 id="ruby-memory-profiler">2. Ruby Memory Profiler</h2>
<p>Also Sam wrote great tool (<a href="https://github.com/SamSaffron/memory_profiler">ruby-memory-profiler</a>) which provide
easily display all required information for any code in block. For this you will need call something like
this (I called this code in my sidekiq reduce allocation PR):</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">MemoryProfiler</span><span class="p">.</span><span class="nf">report</span><span class="p">{</span> <span class="mi">100</span><span class="p">.</span><span class="nf">times</span><span class="p">{</span> <span class="no">HardWorker</span><span class="p">.</span><span class="nf">perform_async</span> <span class="p">}</span> <span class="p">}.</span><span class="nf">pretty_print</span></code></pre></figure>

<h2 id="ruby-prof">3. ruby-prof</h2>
<p>General features:</p>

<ul>
  <li>display <a href="https://github.com/ruby-prof/ruby-prof#reports">different</a> reports;</li>
  <li>fast;</li>
  <li>easily profiles rails apps;</li>
</ul>

<p>How to use:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'ruby-prof'</span>

<span class="c1"># Profile the code</span>
<span class="no">RubyProf</span><span class="p">.</span><span class="nf">start</span>
<span class="c1"># [code to profile]</span>
<span class="no">RubyProf</span><span class="p">.</span><span class="nf">pause</span>
<span class="c1"># [other code]</span>
<span class="no">RubyProf</span><span class="p">.</span><span class="nf">resume</span>
<span class="c1"># [code to profile]</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">RubyProf</span><span class="p">.</span><span class="nf">stop</span></code></pre></figure>

<h2 id="conclusions">Conclusions</h2>
<p>Profiling Ruby isn‚Äôt as difficult as it seems at first glance. There are a lot of great
libraries. The only thing I was missing‚Ää‚Äî‚Ääprofiling the code from a file, but I‚Äôm sure it will soon add
(maybe it will add myself ‚ò∫ ).</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#profile"><span>profile</span></a>
        </li>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/03/29/specific-color-hash/">
        Convert string to color hash
      </a>
    </h1>

    <span class="post-date">29 Mar 2015</span>

    <p>So it happens that sometimes you need to convert string to color hash. I think that
<code class="highlighter-rouge">Digest::MD5</code> class is easiest way for this. For this you need call hexdigest method
with necessary string.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="s1">'My string'</span><span class="p">)[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># =&gt; 'a537d0'</span></code></pre></figure>

<p>And if you will create rgb color you need convert hex to decimal with <code class="highlighter-rouge">to_i(16)</code> method.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="n">worker</span><span class="p">)[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="mi">5</span><span class="p">]</span>
  <span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="sr">/../</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">color</span><span class="o">|</span> <span class="n">color</span><span class="p">.</span><span class="nf">to_i</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="p">}</span></code></pre></figure>



    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#color hash"><span>color hash</span></a>
        </li>
      
        <li>
          <a href="/tags/#ruby"><span>ruby</span></a>
        </li>
      
        <li>
          <a href="/tags/#tips"><span>tips</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/03/16/vim-history/">
        –ò—Å—Ç–æ—Ä–∏—è vim
      </a>
    </h1>

    <span class="post-date">16 Mar 2014</span>

    <p>–Ø —Å–≤—è—Ç–æ –≤–µ—Ä—é, —á—Ç–æ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –∏–∑—É—á–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∑–Ω–∞—Ç—å, –∑–∞—á–µ–º –∏ –≤ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö –æ–Ω–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞. –î—É–º–∞—é, –¥–∞–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç –≤ –±—É–¥—É—â–µ–º –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–µ –∑–∞–±–∏–≤–∞—Ç—å –≥–≤–æ–∑–¥–∏ –º–∏–∫—Ä–æ—Å–∫–æ–ø–æ–º, –Ω–æ –∏ –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å, –ø–æ—á–µ–º—É –æ–Ω–∏ —Ç–∞–∫ –ø–ª–æ—Ö–æ –∑–∞–±–∏–≤–∞—é—Ç—Å—è. –ü–æ—ç—Ç–æ–º—É –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å –∏–∑ —Ü–∏–∫–ª–∞ —Å—Ç–∞—Ç–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å vim-–æ–º, —è –±—ã —Ö–æ—Ç–µ–ª –Ω–∞—á–∞—Ç—å —Å –∏—Å—Ç–æ—Ä–∏–∏ –µ–≥–æ —Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –Ω–µ–±–æ–ª—å—à–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.</p>

<p>–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–µ–±–µ: 70—Ç—ã–µ –≥–æ–¥—ã, —Ä–∞—Å—Ü–≤–µ—Ç unix –º–∞—à–∏–Ω, –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä <a href="http://en.wikipedia.org/wiki/Ed_(text_editor)">ed</a>, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –∞ –∑–∞ –Ω–∏–º –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä <a href="http://en.wikipedia.org/wiki/Ex_(text_editor)">ex</a>. –í–æ –≤—Ä–µ–º–µ–Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –Ω–∏–∫—Ç–æ –Ω–µ —Å–ª—ã—à–∞–ª –æ –º–æ–Ω–∏—Ç–æ—Ä–∞—Ö, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ç–∞–π–ø—ã, –∏–∑-–∑–∞ —á–µ–≥–æ ed –∏–º–µ–µ—Ç –∫–æ–º–∞–Ω–¥–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ê ex, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, —è–≤–ª—è–ª—Å—è —É–ª—É—á—à–µ–Ω—ã–º ed. –ü–æ—ç—Ç–æ–º—É –≤ –Ω–µ–º –ø–æ—è–≤–∏–ª–∏—Å—å —Ç–∞–∫–∏–µ —à—Ç—É–∫–∏ –∫–∞–∫ —ç–∫—Ä–∞–Ω–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏, —á—Ç–æ –¥–ª—è —Ç–µ—Ö –≤—Ä–µ–º–µ–Ω —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ—Ä—ã–≤–æ–º. –í —ç—Ç–æ –≤—Ä–µ–º—è –º–Ω–æ–≥–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –Ω–∞—á–∏–Ω–∞—é—Ç –ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã, –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö, <a href="http://en.wikipedia.org/wiki/Bill_Joy">–ë–∏–ª–ª –î–∂–æ–π</a>, –ø—Ä–∏–¥—É–º—ã–≤–∞–µ—Ç –ª–æ–≥–∏—á–Ω—É—é –∏ –ø—Ä–æ—Å—Ç—É—é –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –ø–æ–≤–µ—Ä—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ ex. –í–æ –ø–µ—Ä–≤—ã—Ö, –±—ã–ª–æ –±—ã –ª–æ–≥–∏—á–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–µ–∫—Å—Ç –∫–∞–∫ –æ–±—ä–µ–∫—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ–º–∞–Ω–¥—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –í–æ –≤—Ç–æ—Ä—ã—Ö, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ unix –∏–¥–µ–æ–ª–æ–≥–∏–∏ –æ –ø—Ä–æ—Å—Ç–æ—Ç–µ –∏ –≤–∑–∞–∏–º–Ω–æ—Å—Ç–∏ –∫–æ–º–º–∞–Ω–¥. –¢–∞–∫, –≤ 1976 –≥–æ–¥—É, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ vi, —Å–æ–∫—Ä–∞—â–µ–Ω–æ –æ—Ç (visual). –î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∂–¥—É—é –∏–∑ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –æ—Ç–¥–µ–ª—å–Ω–æ.</p>

<p>–í–æ –ø–µ—Ä–≤—ã—Ö, —á–µ–ª–æ–≤–µ–∫ —á–∞—Å—Ç–æ –º—ã—Å–ª–∏—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ, –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞–±–æ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∫–∞–∫ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–±–æ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤. –ù–∞—à —Ä–∞–∑—É–º —Å–æ–∑–¥–∞–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ —Å–ª–æ–≤–∞, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã –∏–ª–∏ –∞–±–∑–∞—Ü—ã –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω—ã–µ. –¢–∞–∫ –ø–æ—á–µ–º—É –±—ã –Ω–∞–º –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç—É –∂–µ –∏–¥–µ—é –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ? –î—É–º–∞—é, —ç—Ç–∏–º –∂–µ –≤–æ–ø—Ä–æ—Å–æ–º –∑–∞–¥–∞–ª—Å—è –ë–∏–ª–ª –î–∂–æ–π, –∏ –ø–æ—ç—Ç–æ–º—É vi –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å –Ω–∞–±–æ—Ä–æ–º —Å–∏–º–≤–æ–ª–æ–≤, –∫–∞–∫ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã, –∞ –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –æ–±—ä–µ–∫—Ç–∞–º–∏-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è–º–∏: —Å–ª–æ–≤–∞–º–∏, —Å—Ç—Ä–æ–∫–∞–º–∏, –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º–∏.</p>

<p>–î–æ–ø—É—Å—Ç–∏–º, –º—ã —Å–º–æ–≥–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∞–∫—É—é –∏–¥–µ—é –≤–Ω—É—Ç—Ä–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞, –Ω–æ —Ç–µ–ø–µ—Ä—å –≤—Å—Ç–∞–µ—Ç –≤–æ–ø—Ä–æ—Å, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å —ç—Ç–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏? –î–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –º—ã, –¥–æ–±–ª–µ—Å—Ç–Ω—ã–µ –≤–æ–∏–Ω—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Ç–µ–∫—Å—Ç–∞, –¥–µ–ª–∞–µ–º —Å –Ω–∏–º–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å - –∏–∑–º–µ–Ω—è—Ç—å –∏—Ö –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –ø–µ—Ä–µ–¥–∞—á–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–π. –ö—Å—Ç–∞—Ç–∏, —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π –º–æ–∂–Ω–æ –ø–æ–∑–∞–∏–º—Å—Ç–≤–æ–≤–∞—Ç—å –∏–∑ unix-–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, sort –∏ –µ–º—É –ø–æ–¥–æ–±–Ω—ã–µ. –ü–æ—ç—Ç–æ–º—É –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∞—à–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–º –Ω–∞–±–æ—Ä–æ–º —Ñ—É–Ω–∫—Ü–∏–π –≤–∏–¥–∞: [–∫–æ–º–º–∞–Ω–¥–∞] [–æ–±—ä–µ–∫—Ç].</p>

<p>–ê —Ç–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ, –∫–∞–∫ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º —Ç–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–∞–Ω–¥ –∏ —Å–ø–æ—Å–æ–±–æ–≤ –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤, –∏ –ø—Ä–∏ —ç—Ç–æ–º –Ω–∞–º –Ω–∞–¥–æ –∫–∞–∫ —Ç–æ –ø–µ—á–∞—Ç–∞—Ç—å –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç. –î—É–º–∞—é, –º–Ω–æ–≥–∏–µ –ø–æ–Ω–∏–º–∞—é—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –∫–æ–º–º–∞–Ω–¥ –∏ –¥–ª—è –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ - –Ω–µ —Ä–µ–∞–ª—å–Ω–æ –≤–æ–æ–±—â–µ –Ω–∏–∫–∞–∫. –ê —Ç–µ–º –±–æ–ª–µ–µ –Ω–∞ —Ç–∞–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö —Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/KB_Terminal_ADM3A.svg/1000px-KB_Terminal_ADM3A.svg.png" alt="old unix keybord" /></p>

<p>–ö—Å—Ç–∞—Ç–∏, –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ñ—Ñ—Ç–æ–ø, –≤—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–¥—É–º—ã–≤–∞–ª–∏—Å—å, –æ—Ç–∫—É–¥–∞ –ø–æ—à–ª–æ, —á—Ç–æ —Å–∏–º–≤–æ–ª ‚Äò~‚Äô –≤ nix like —Å–∏—Å—Ç–µ–º–∞—Ö –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç home –¥–∏—Ä–∏–∫—Ç–æ—Ä–∏—é? –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≤—ã—à–µ, –∞ –∏–º–µ–Ω–Ω–æ –Ω–∞ –∫–ª–∞–≤–∏—à—É home ;)</p>

<p>–¢–∞–∫ –≤–æ—Ç, —Ç—É—Ç-—Ç–æ –º—ã –∏ –ø—Ä–∏—Ö–æ–¥–∏–º –∫ –º–æ–¥–∞–ª—å–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É. –ß—Ç–æ –∂–µ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç? –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∂–∏–º–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–º–∞–Ω–¥—ã. –í vi –±—ã–ª–æ —Ü–µ–ª—ã—Ö 2 —Ä–µ–∂–∏–º–∞: —Ä–µ–∂–∏–º –≤—Å—Ç–∞–≤–∫–∏, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –Ω–∞–±–∏—Ä–∞—Ç—å —Ç–µ–∫—Å—Ç, –∏ –∫–æ–º–º–∞–Ω–¥–Ω—ã–π —Ä–µ–∂–∏–º, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –Ω–∞–∂–∞—Ç–∏—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∫–ª–∞–≤–∏—à, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ–∫—Å—Ç–æ–º.</p>

<p>–í—Å—è –ø—Ä–µ–ª–µ—Å—Ç—å –¥–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±—ã–ª–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –µ–≥–æ –∏–Ω–Ω–æ–≤–∞—Ü–∏—è—Ö, –Ω–æ –∏ –≤ –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –≤ 1991 –≥–æ–¥—É <a href="http://en.wikipedia.org/wiki/Bram_Moolenaar">–ë—Ä–∞–º—É –ú–æ–æ–ª–µ–Ω–∞—Ä—É</a> —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –≤–µ—Ä—Å–∏—é vim, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ <strong>V</strong>i <strong>im</strong>proved. –í –Ω–µ–º –±—ã–ª–æ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º, –º–∞–∫—Ä–æ—Å—ã, —Ä–∞–±–æ—Ç–∞ —Å –∫—É—á–µ–π —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –∏—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –û–° –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.</p>

<p>–¢–∞–∫ —á—Ç–æ –∂–µ —ç—Ç–æ –≤—Å–µ –¥–∞–µ—Ç –Ω–∞–º, –æ–±—ã—á–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞–º? –í–æ –ø–µ—Ä–≤—ã—Ö, –º—ã –º–æ–∂–µ–º –ø—Ä–∏–æ–±—â–∏—Ç—å—Å—è –∫ –∏—Å—Ç–æ—Ä–∏–∏, –∞ –µ—Å–ª–∏ —Å–µ—Ä—å–µ–∑–Ω–æ - –≤–≤–∏–¥—É —Ç–æ–≥–æ, —á—Ç–æ —Ä–∞–Ω—å—à–µ –Ω–µ –±—ã–ª–æ –º—ã—à–∏, —Ç–æ –≤—Å–µ –∫–æ–º–º–∞–Ω–¥—ã –ø–µ—á–∞—Ç–∞–ª–∏—Å—å –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ, –∏ –Ω–∏–∫–∞–∫–∏–µ –í–∞—Å–∏ –Ω–µ —Ç—ã–∫–∞–ª–∏ –º—ã—à–∫–æ–π –≤ –∫–Ω–æ–ø–æ—á–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ. –ù—É –∞ —Ç–∞–∫ –∫–∞–∫ —Ç—ã–∫–∞—Ç—å—Å—è –º—ã—à–∫–æ–π –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –¥–æ–ª—å—à–µ, —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–æ—Ç–∫–µ–∏, —Ç–æ –º—ã –ø–æ–ª—É—á–∞–µ–º –¥–æ–≤–æ–ª—å–Ω–æ —Å–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏—Ç –≤ —Å–∫–æ—Ä–æ—Å—Ç–∏. –í–æ –≤—Ç–æ—Ä—ã—Ö, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –∏–∑–ª–∏—à–Ω–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é, –∫–∞–∫ –≤–æ –º–Ω–æ–≥–∏—Ö IDE –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö. –ü—Ä–µ–¥–ª–∞–≥–∞—é –≤–∞–º —Å—Ä–∞–≤–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã vim-–∞ –∏ –∫–∞–∫–æ–≥–æ-–Ω–∏–±—É–¥—å eclipse.</p>

<p><a class="lightbox" href="http://2.bp.blogspot.com/_ZzOZmj1dP0c/TNcTx8DygaI/AAAAAAAAA0Q/Ar2BsQs11VI/s1600/gvim.png">
<img src="http://2.bp.blogspot.com/_ZzOZmj1dP0c/TNcTx8DygaI/AAAAAAAAA0Q/Ar2BsQs11VI/s1600/gvim.png" alt="Vim" />
</a>
<a class="lightbox" href="http://upload.wikimedia.org/wikipedia/commons/thumb/d/df/Eclipse_4.3.Kepler_screenshot.png/800px-Eclipse_4.3.Kepler_screenshot.png">
<img src="http://upload.wikimedia.org/wikipedia/commons/thumb/d/df/Eclipse_4.3.Kepler_screenshot.png/800px-Eclipse_4.3.Kepler_screenshot.png" alt="Eclipse" />
</a></p>

<p>–°–∫–∞–∑–∞—Ç—å –ø–æ –ø—Ä–∞–≤–¥–µ, —è –¥–∞–≤–Ω–æ —Ö–æ—Ç–µ–ª —Å–ø—Ä–æ—Å–∏—Ç—å, –≤—ã —á–∞—Å—Ç–æ —Ç—ã–∫–∞–µ—Ç–µ –≤–æ –≤—Å–µ —ç—Ç–∏ –∫–Ω–æ–ø–∫–∏ –≤ c—Ç—Ä–æ–∫–µ –Ω–∞–≤–µ—Ä—Ö—É?</p>

<p>–í —Ç—Ä–µ—Ç—å–∏—Ö, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –Ω–µ–æ–±—ã—á–Ω—ã–π, –∏ –æ—Ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π, —É–¥–æ–±–Ω—ã–π, –ø–æ—Å–ª–µ –ø—Ä–∏–≤—ã–∫–∞–Ω–∏—è, —Å–ø–æ—Å–æ–± –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ç–µ–∫—Å—Ç–æ–º. –ü–æ–¥—É–º–∞–π—Ç–µ —Å–∞–º–∏, –≤—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç–µ —Å —Ç–µ–∫—Å—Ç–æ–º –∫–∞–∫ —Å –æ–±—ä–µ–∫—Ç–æ–º, –∞ –Ω–µ –∫–∞–∫ —Å –Ω–∞–±–æ—Ä–æ–º —Å–∏–º–≤–æ–ª–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –≤—ã–±–∏—Ä–∞—Ç—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤, –∞ —Ü–µ–ª—ã–µ —Å–ª–æ–≤–∞, –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã, –ª–∏–Ω–∏–∏, –±–ª–æ–∫–∏ —Ç–µ–∫—Å—Ç–∞ –∏ –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–∏–º–∏ –∫–∞–∫ –∑–∞—Ö–æ—Ç–∏—Ç–µ.</p>

<p>–ù–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å—Ç–æ–∏—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–∂–∏–º–∞–º. –í vim-–µ –∏—Ö 4: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º —Ö–æ—Ç–∫–µ–µ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ —Ç–µ–∫—Å—Ç–æ–º; –∫–æ–º–º–∞–Ω–¥–Ω—ã–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –º–æ–∂–µ—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∫–æ–º–º–∞–Ω–¥—ã –∫–∞–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏(–∏, –∫—Å—Ç–∞—Ç–∏, –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–º–∞–Ω–¥—ã —Ç–æ–∂–µ); —Ä–µ–∂–∏–º –≤—Å—Ç–∞–≤–∫–∏, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–±–∏—Ä–∞—Ç—å —Ç–µ–∫—Å—Ç –∏ –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–º, –∫–∞–∫ –≤ –æ–±—ã—á–Ω–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ, –∞-–ª—è sublime; –Ω—É –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π, –≤–∏–∑—É–∞–ª—å–Ω—ã–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–±–∏—Ä–∞—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–∏–º. –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ 3 - –æ–±—ã—á–Ω—ã–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ, —Å—Ç—Ä–æ—á–Ω—ã–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç—Ä–æ—á–Ω–æ, –∏ –±–ª–æ—á–Ω—ã–π, –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –≤—ã –∑–∞–¥–∞–µ—Ç–µ 2 —Ç–æ—á–∫–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞, –≤–µ—Å—å —Ç–µ–∫—Å—Ç –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –∏ –ø—Ä–∏–≥–æ–¥–µ–Ω –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. ( –°–∫–∞–∑–∞—Ç—å –ø–æ –ø—Ä–∞–≤–¥–µ, –µ—Å—Ç—å –µ—â–µ –æ–¥–∏–Ω —Ä–µ–∂–∏–º, —Ä–µ–∂–∏–º —ç–º—É–ª—è—Ü–∏–∏ ex —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–Ω —Å –ø–æ–º–æ—â—å—é <code class="highlighter-rouge">Q</code>, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å —à–∏—Ñ—Ç–æ–º, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã –ø–æ–ø–∞–¥–∞–µ—Ç–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –º–æ–∂–µ—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∫–æ–º–º–∞–Ω–¥—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ <code class="highlighter-rouge">:</code>. –ß—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∏–∑ —ç—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–±—Ä–∞—Ç—å <code class="highlighter-rouge">visual</code> –∏–ª–∏ <code class="highlighter-rouge">vi</code>. –î–ª—è —Å–ø—Ä–∞–≤–∫–∏ —Å–æ–≤–µ—Ç—É—é –Ω–∞–±—Ä–∞—Ç—å <code class="highlighter-rouge">:h Ex-mode</code> –≤ vim. )</p>

<p>–ò—Å—Ö–æ–¥—è –∏–∑ –≤—Å–µ–≥–æ, —á—Ç–æ —è –Ω–∞–ø–∏—Å–∞–ª –≤—ã—à–µ - –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é —Å —Ç–µ–∫—Å—Ç–æ–º, —á—Ç–æ, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º —É–≤–µ–ª–∏—á–∏—Ç—å –≤–∞—à—É —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/–ø–æ–∏—Å–∫–∞ —Ç–µ–∫—Å—Ç–∞. –°–∫–∞–∂—É —Å—Ä–∞–∑—É, —ç—Ç–æ –Ω–µ–ø—Ä–∏–≤—ã—á–Ω–æ, –Ω–æ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, —ç—Ç–æ –∫–∞–∫ –∏–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–æ–Ω–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞, –∞ –º–æ–∂–µ—Ç–µ —Å–ª–æ–º–∞—Ç—å —Å–≤–æ–π –º–æ–∑–≥, –∏–∑—É—á–∏–≤ –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å lisp –∏–ª–∏ haskell. –¢—É—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ, –≤—ã –º–æ–∂–µ—Ç–µ –≤—Å—é –∂–∏–∑–Ω—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–Ω—ã–π sublime, –∞ –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ. –ù—É –∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –º—ã –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ –æ–±—Å—É–¥–∏–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –∂–µ –æ–Ω –º–æ–∂–µ—Ç –æ–±–ª–µ–≥—á–∏—Ç—å –Ω–∞–º –∂–∏–∑–Ω—å.</p>


    <div class="tag-cloud">
      <ul>
      
        <li>
          <a href="/tags/#vim"><span>vim</span></a>
        </li>
      
        <li>
          <a href="/tags/#history"><span>history</span></a>
        </li>
      
        <li>
          <a href="/tags/#russian"><span>russian</span></a>
        </li>
      
      </ul>
    </div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
